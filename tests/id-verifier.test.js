import test from 'node:test';
import assert from 'node:assert/strict';
import { processCredentials, generateNonce, generateJWK } from '../scripts/id-verifier.js';

const androidCredentials = {"id":"","type":"digital","data":{"response":"gmVkY2FwaaJjZW5jWEEE5UR9BCSTMpZ1r7zGAUiBeYwEkvVIuhRaVdmq7KndEQZp3V-CDzRq6sxtGHKku_iSUKPDdxxAyywQpDDJKJlGNWpjaXBoZXJUZXh0WQyjGchl2ZYr1toGhp-CCGXqiOiZVZkWhydfZFWXcMFItMdW-b-Dd6LEtRl4Ek4HRjqyXv87HAGmiR7Xonu6SmNPkRBw6K_lO9RHozgXIM9qwVFXZZqzm_FIuT4kOTmh1UpiUGZ2SVHm0GoTjc9WGTa-pmGK4XzCVW0scdviON2T6TklZcmhPohPeiPmkOKWDZD1zHHXHlBinE3L-0xBRUwOBIgGgpMjzZhqeQJzCzm3LrcnQ3bm9Gxz6wb6qcurmw3cc1mGf9w44xAeezu84eJyvcx3oeiaWq23qVwwclvH1al2MeiTI91v9lBeA2E6d1glWfksvUI9pwOT048qvodPhLL566G0E_hbqISHVlADnO6eGlZ9Uy5qwCULbC0INh3Y9x-3qFt9Czr7Y4gHRfpPSNcmkHmNt5XmeDAG7a1Jl6N2G1kWYTWY8K0dNg-TqN8UzxVwUj6RTXVJiDDh6NCsYoY-gZYjCjZk0IKeA86tT3WKHpmhSbKjgi0oTWJFYeUSvfUBGcsVbXEwWDoIPxsgIoIFOy3Kb36VQ0v_r34Ovq_luhvUACe9553D8LUEKLOgxjbGKYDsxFzS5fmApHWtl-SFnJfCfClSVpvSvf-eJ_sDHO7uJnDtOEf775D6nmRGA0SrXyzf38UUwuybmy8OZudE_d0wjBDvjRAqnjrxTk40W3OxCQnjvmeeewIED5f-NWxwhLqynNhvHk7nf-E2xd8--RxboJhkoPGAO16SK9KRvqCfdq58TERVsF5RPh4prZHVKPK9Ytxv-eX6ixYMdI4On2Lijxwn-RndQX169iQH1gkBAQOQFg7fULCzhcoOGYjhRvpaGwVIsv91-ZPzQJtYNQrVDkrVZpfc3uzdl3Hjh763xVLcD-BUOCL3wLvzGoLNL7fFtVWGGEFQMnRQyl7JaVTsAkiS8eY7ppY4SgdKnEMXxPAiBapZK33n1nzHawKyNodgzIDx2DSKaa2yDoq0JkTgu6XByJmN5QrA30vpm9QXm2jKvSFDfvyJ-Oem-H9dgydSCPoVYjOh5Y0KeI7t9pfaZvZhSO1Y4v6lyCnyEqzfy7S-xPwwZYZbLeXJYk5RS1lvgcCIvS1su-2IEpJPrEglfD8bAszanzDAponAPnIAQx6yy7-rYyU4UrbLuchw-8XEHKflG7R9iJS0fJMBwEnucTPKD3ga-N_LmF6Pn0sNXDzP-4_MUr0CZiySG5-vEf5eQdLA-m2J4CXUNol41BpOuWrQEYHioeEWmED6OT-sUM1foZMbcaAcx6KzoF7VOAoPTGy-vqHWJzH8my0ZOouIC_HdbhZYVGDu3Qx0GSKErsviq2oEgu8yY4CvbPC8C7hQpif3m-kDF_jhxg8kUpJacBxhoF2fPzikA10jkHnpWOwCxGduTqywVpqXYe8LhSeJxtl29W3Hnf-VhkktxyDHwQlB08hvXHaLJqOIoHSWBeOTIYHqJhe_QAmRUgLjZFPScofjY-Ej3p2DE3i8qEtcJEb1hv3wN-0q1ALmmspsLzfgG60rj5opCjy_-BfgiZwL9t5vUsOsjsOrej7XOxRTMV-6iTl5JoGJYdvHjJ3ZepgCgQkWxIX7FVv_8hx2MdO8VYzVFFs_NMZ4lF78X4gCKwlMVU_nmOS_e9i79xV_nLoBrmuFIxLc-tcP0yzOtPonWuXn6LxyBowdJoHjLhU0Br9f6G5_Nvt4KZWLSiTXglVbY3XIo-q5zFLidsNkmL2_eOKbixc7504nJ9oX82fJKxg9pIE3OsLl4Kx8doarXLDC9C3pqRdDsKZR2BHa4Qe-5J-qjpaTMudO8tJepy2-xIICDM9-NVFWPzEdO32ZusZdEydiTFN6sT97s9TwX4iwSkEnYv10hqdfEcoolTQihVDiGM6HtEenFl0TaORXHFoLE_2e_9zZ3SwTiINx073FHePODTRKig_NKNx8jciwa7lG-gFhs-PtROjHzN4dbJDj-cd2qTwjtqzi9zkaDmwinOVwI8PRPMJD5DiBQ3j6dtwFC63CJeh8UGN2NUNliQIDx5L2wVG_9woLNaiF9zVGUEwPDBEyxR4wFcHCMMRDVBN6hRRJICX32fnDjzYc2ku_Q15UjHg3NQ_OlIUZNeaXQxBfzqpBRHrkn4QYZeF2U4PlJw38VAQHF6ms6JnjEFDLJmobyWXK1MYqaFidbHdBkT7ZxOq1jxZIKdKVWArcYl1vKMsfmMmjQfyv4ppZXSuqAmix0tjxtZMJE1Njt8BQAKIMv5n0g2A2H1SrnU83TQ_aY_jNf7PrtJUAGy_VS3dh5wq_4SeHTjwoDE199FTYFmNXQqt5ftCfIINAw4-gRl6RErdTwx0fpFdRo3hmKqwEWqt5onkPFLl5TWYjvcSXpBqaIciXKX2lLzQVLzO5f_Bu4PiPPb2LbrgNnSi1VrmNgbwZd6-0LRb0mwwN0NlDbxOLrSze2BZA9YHwd1njKmBaXFPju7osX4K5VaVSqbZ7ZD6z-xTi6YMiY1CoFhWW5TtIfLqB2xRP0TuLSIzbMVX0B3_3ifLBU6XOkXo7xemuDN8-gtFLOo5bAJV83snmBXEjUlclRCgz-jrSNLeNJdxpmU_RRglgT1ZNaiGKAPUq3MGWNQmfWlZsGjz-fvrhjjvN1fGGjTH2dUzdgVe3TbTPO6XSZFGKARQseg9UQHpus_ExYnGYvJGPzD3FfRy0r2wNAdScqqeiRhIiCJMCv-FOg_075xoPtVyp08HCJKiOPvEM0W2vua4ippbWWlXKauaaXkejHwIyFyXSeqZObgeQz_5JC738E40j5JTdlRoqmEo7XNCvDvZE6VVG37fdmbrMB6RXaHmw-IGffyseBnvBRpHp4L5eO29JtIYGBbmiqJjZzvcTCZ9aZBnm3k1VZyomO4nEDkk7rHrI5gCOapWQpgb0jVaiqFB4uSZVCbDcDGbaUfs4gH5E3wli6usrCix7rkA67-iTGfRyuFZU3Pn_8IG4aHKMTkB-K3-d8ui3dPeFAhpL50Qd_EJNkqdkqRj0NPbeEvsOc51kRLqC4LB_ZWRGooqdjKuZTBKhapG7fVH190oFVgVLX86t9gfwhdfNQpvgu-IHen9O8fm1v5pCrq_oAUy4p98CoJbFyHlUVYGyvK_cQEyWCZlXSXGvyi_jrm-DZd855cyfPwM1OAsjAfS3goQ97XoBuiWW64QRTZU9oiKjE1lFp56se-8kfaHJ4aPjAGawMvq7QfCDTLfcbJhxd1Ta_DvXmN7QSgoyEp1Wi60h5tE40meZTkLYb8ZQaj7kGRDW4iMxXkV1F1gvMTNjL4BJ_GpMQx4_std4VIzGh6aZDZirtcX_FaqEP6AIyhrMbe6CX8qaU5CMJDSFNtbmAiQTFBnClmk9m2vHBiL9UCeD4qhaVZFfqDfwnTEVYOb5VpfKPhb1aTsQfqF9umoOzhZkApzMUoY9536wWUUnWN9ohpI-TJdDN7b24Ne-97GrHY2L2C0uXCXT6hEKYSPNnPAialuSk_G9wCF2GwHImOujqQZzQHMkdF18f1mO0QuiC0jfUWm5swQk4fRgbu_-I8sZHFOCSRpspD97mmwz1KUokPFZduTv4Fvzjbv7GDo4HDdTuGJ5y8qmRP4_k0M2K1Bb6YtVanrBR2UT0N6_30jJQn2wy9s0JwcdKw6QkKRI24wpfr7j210kTG5_f-4AKB8Gpn5TSuspHiW0TrThfC4MwD8tl5LuCQlvl1NGSkMYTDdM-bPHa16W2hRWadI8Collh-ZpzNKsgAJz7mI2ddYNAjhSEIEtRQqJ0PP1X3dWUmk5Rt81Qt3DkDpzi4sNkltG5Lk8s1sI9cHfJaLp1_DmlOHC48Ol_lpaAlmeb_QTWjl9WuvoAd19shtN7qVFO-_4YuddF5wd8QhjfQm9UBrDRLDulydtFEOEN0n-sPiGRND4SiNaL60If2z7yLVKyPrAv7qFH0nloTll8_g4rxnYWNpIO369JLcRD8Iq_3fjqYAaOODwt5JngePU8FK5-eT4nmMTlQ6NNmVYX_BFls_nsxhVnFdqJj2G3-i-vH6T85ky5_D7G_0WhbDXZSGhOsZSZIgAFoWi_KBmmsmAtHOJ_eezSVrs8Nc25Itab4Th3TBMnGdHHmMFUbtvrxJhuTDkpcaHhK-OUh9xsf4W5ciqroIZMYeETdBheIw6YJty6wDvclencYgs4ujpU05aK_RvlYR2D1UsMkGkDt3pWLmEdyH8vmlwsYA15ax5F1Hs6LPTf-OdbwS1MrE7bmTq5lycx0XKsNqzJnhrzyTgsuHyzWNK6JPTHUSm2Or3yMUaYlYTUNMCzw"},"protocol":"org-iso-mdoc","timestamp":"2025-08-07T19:43:23.653Z"};
const androidParams = {"nonce":"c111d1f946129d75d78e5699db8438c3","origin":"https://10.0.2.2:8000","jwk":{"crv":"P-256","d":"alc5z82ICsACQDmMMiBuA3fyQ0utHa--SNh6w3534Ek","ext":true,"key_ops":["deriveKey","deriveBits"],"kty":"EC","x":"jgOzACBKyR0Bozuih_tyladUzv-J_N2UC-6Wl-rshuQ","y":"9oMW6zr3b7hfaVSWHEz1F08TlXj8aufRMYyzRE5dNxU"}};
const iosCredentials = {"id":"9d7a8af7-bcaa-43d3-871f-abc065d753f2","type":"digital-credential","data":{"response":"gmVkY2FwaaJjZW5jWEEEUX7w3JQppVWv47smYvcHtjsbS8_2q_u8XiBDjEtfHPgFXCDIajuOJ3guaIuhxyMflU_2cLbgvRNaNgjUQy9xPWpjaXBoZXJUZXh0WRbT8_kCeqK9-Yl3r4sOK-dE6PKgTr6Xucy4s2SIPcNT7KR8DaTOLfdqlRpHyZUOw-qEBAj_mGDMsJIjD19erA34rp6QigFIfqJBjCmT4CGP8sWeQWhxSe2vTwug6mMGfDxsMUcKZTLutCJ8Dt7ld_zZVNw5O0nTELJWLyll0gV4fjKP54lTMexwSzHagN7RXQUPxD39o-hpv9seVhlNOuPbJJcTtSnJNmx9ER2-kq1ycrd3St15NM3RzBDRKVfNJYQsJsvi9CZ7C-qV_7fk6vjvG48yezgVRJ9A3vSOltWRKs6TPileeY1wl1fl-CRQN_y7uYXYxpZ3KWxSLnOTiptABItjgMKWf5JLFxyC9W6LhcJ5pi2kkC99N0Peg7rEXUra4S8WMk3voVQ_anCj_lzodHxIfcZO1a-ENswjBULJZUVJsOGfT9s_oU3Ox9UCWVrz0MWApMtiGsWB2dfDv1ciJ8QbpbidFzyWHzEHTulARvilk6ej7slesmv3dvfAiriuZ5rRJuEgieI-hVJV9SfEZIGtT2m-Tx2Lh9E7frUZHqwbsfUhHH1DXse885AzXRozCz6yOE07g7p9Z6hhjv9RPDUvKP9WR231LNXCHlk9hGBuXM-kA8DPgah1y_WQARVJ15adabfH3KksG-dCFDx9cosPoGQbYdSt0jT1QdcEdwF33LyQthgvk_g57adRIxMP2ayDbFGrzz-7EZQQkvuOWep1gmhCKXKDwUGNdo1yosssE1cBNpU02_fPfkAnddGVyLTZEmMrh7QNs5lujja1_o6-9I8xwlVk_QduOPYExSQ6MJTEUdUf_TpY-bA9AmoMcl139VnTwYK36n6_SzdNTTMnFHlPW7vQHvEhvsCeh6LkXjsre9D5JNozShoEnCeCsfZPE7PWwcSTEa2sqPA_hx-OlFYEMUMmpsDVinvGd_kvSUSTi9hsnkdIRzUTiCqI8QBajvkGUpNieR18t3IbopjcwxLlCWpOBg1ttzfbJVyFFPJNvP154JOS1c3xzsMiONJbT20vxNwZRcpXn1UpPMhsxuI5HAx-cFOmoeeiTepRhqz_7vB4zQT7I6LRjjd7DirRZegeOFKgSM32d3nqYXIKlsfSpMYm_8PO44lUz8lZqvy4SdeA2kCkyb1pnq6CS-JvudZXUlku6Nq7W68eq-vSNGmIeBXZ8q74fjcm3PqRTEM1f-E-XePUA4YV5M4EC40wJESS2IKf_VBB_UurxDLRjEzZiaMXJuQKEu2yd6FPpuSnX-vH7FfMUIZIEHkhPAt_45wJoeqYblXOwTlHJBTSwfBOoUYgzl9LTjjwCpogRibSj2efeuVoXtWIpePkAlA1rMJwCz3RcZzpWc7neRv1B21eQ63In-P06iUYkBUo-khXqjb15puEjslbf-3Gx0Gsfbbt1-AnQZDTpDH3K0Il1R2w55gaw867Nqcg42KeYr3Yr_ZcNViiLSaPnRevXDiSXdwc-m_-XIWM9XKyBOORf7syL0oAudUaq2hQOhB3AMYdcx0h6a6ppSia3QAsKl8SzpQWpAay_Uhvrq7XQW71iHz4DrdX6ylwJTPUCfTY3nyk0e33tuRKCu3uSU8bHDcTcT7YVjoHceEkA0G-2xGrANViLpHU4k1-Hiq1HOxI1MM7gcR4bcAho5Z0dPgKa1tFd8Pa0ZqEll1Nh8AWc6uLlz0Un8b5PlVsAwyFPtod_GMhGI4ApxHpH8LJ3h8cNLfF_pudlcYRprQI9mFe9G4HV8h-nssTkVBHglTYU0A6UPsCsqgtBjGuXxUmtRQBJIcpQM5tUIU_FEnX6fl2IJrWn0QIa2POJIRRoZSi84il_kQTZkC9gM2CUWqCFUEJ1fyLppATeQ-43ci2uLY7FclyaHSPpI-zxEowrO10FNPKqEJNpIbZTury-_n9HmRX_p1Csk7jNw1Uyjrh5QyMMEDxGqous7t3Wv6GxU5m5m1Qh52AYfTlXZv6NKji97OdkaDWdeoXUKqG_-kkyitf-OQaKaiqzY7scrCArPwDuq-zc8cLxVelE3_TrcxL5loHFHE1aK7-R3qSxqJzf7LpxjFnuD-7vs1oqJx9HKL1SS-_tYBqFafOQdq4BZS1vLg3R6FUGk2iHFgLz5JmUgauuh2Ub4zTI_G-uje-DHpEEQW0R8RG-fs6huC5NuLx8b92rZJaIwE4bR4Bi1IDiQ_o_rJv_vRSuSeW9k6S4uF2ZCS2wuRqbwl8oIip6H7jx5xPrng2qcSHqiRb-IgHRahdCdEkz2__AmSsYTZtyZ6932ixPz4bgPn_l3wL1TbSFOmhbs7IIyeYPDXANBk8q5SNjTA6Qf3DNGO2Ek5clA8DlLAHz4_mrvIsrbl5AjZUbte3VbunoUUNrTk0rmKXLwd7zkbqrIXJ-yDz50HFSiE-2z1ptLZuD-W_UFB6yhAUvyE4z29r4I6lRIQJTovTWsjNNqBW8GRrzFZgAC7fCTHj3Mv1b2mziQtAtL_3ZSYGg9MqcEpAUmtewzQYcD68yM0RzDz5YhbXufjHFpWAQgjI9_QzoG6RMfdQmvqWFR1qYxvt8lskTlWuzVQ-ufypQKML1fjQPwlMqXV31FD8buWfCe4EuX98ZQF3TnMuNwbS1kZKv5GpcfF3S6hNVudE22hJJ14F4NhS6Ub_wRUbQuhjBg6rjpkedSvrObxEEYmkSRKwJ8_lDSgN3mLpLg5HJMhDWnJlN8p8jVNcgh737RLPo1TblDCXiplrY2NBD1xX2uUQX57reWOZ3UcvGQHFJCFLV2GZiY41JNd2ovUTdqhELm6Uq3sqVIAHGawyec52wh3e9NH4ZRism0QjHXlzRV47xDJdq6214OhKdiEmxEIGCELOUbWpri1qGPxaVCLn7gjvqVPle55EPnzjZRoc7u7RrMFt6z-d-VAQyOYgOCVlU8E44OZyjU8iai56H8qKeBhqjbpAmdpjx7DJpvmH6dRQqt_nP5QPgl2fvxzAjTR-_kO02SvzNrKaMVJKmYwZb5DdV2TQ4GWfH6ykoDbNMFd5uiarwlZ1_8YLBksMFhdftv9ob50ty_pMoR7xeod5aURgN-jUrg-Rpd3mbbGCnAyOS54vKFmMlW7qUZucrtuoSOGRrLelVL79rOP7a1HBwHqwFWw4OVvRRMld4UpiaEOCaL159j2YQs9_IQMiqabGoboZhtJBqwsI4gbaGyBOsZpyKd3g7vkFuPTr23CGOIHaN1o6mHQAHWIiVVa92ogz4pdep16ekx5_gMAqyhPVpqCl2xScd3bbE65M5m1Zd6-LNmzG8xiu2zpJlTjBrmaoE2JbCjh-InL1aPbnGFCrFcSOq7vWGpmN0uu5LsCLiQQ6jybucP2WR_1HefjQTZLjO_fmg4KXYQt9NYiS7laeQKD8zaTbLVjm9gU7D_6M1TtK19UF_4HywLKcSekgMUP5ZeqeZ1licECH0p5zVo4KtVXShIM8jlXFkxU29MJKdfSzI4K44g_VXDkVhR5M7f_77AfZ_0z8mNxhZI0lk9tFBGebnexdQoMd9oC3VJK8vfajIYzLP7S8voJNxAwnrInMuFbGO4Ve47w8OATu7XnJMpNz5E4Cx3FG1iFLTyOkxxzGS4PPkOTal9XSctOeC8tblErNUSMPpIRJG4QwBjVxc2isjdiNHr6LEuVyAaU1UQQtCLnVz3DtVsB-kUmCFCZge3Q5SIIYofaTpbQQ4qj_pCCYtIPJLp2OrQmRQr6PkVMbBe3uRnevPazDFjWQgra4Q_yJvE-rW7c8ABbyU7cJ-ADZ3B9zFssInCLh8IdriSi87HkSEjj6yH5w_ZzfJaKRJ9yoOAWoHSZLqk4xeAw0KBS8oGUOwvOQ4ZsBL7uQxAlTAYy2XnoWemTZXUeudeNTy0LeNaW2qHaR_dx3cT2Y3MNllF1rYjvvbVVLzhBlD2nWWVFIZ1zZBGRKgIO-hA1uGEDKkP87D96frAyAPZan8QQnz6_mUM1kEl0UbT7P9ZBnPT-JJ-RxVGbP6-l6Sj4MmZ_EXpPqakoCHWPPc2ehJMDLZuYxCBYB3Evm8vcqqOUd9SnxMX-Q6CjliP5FIgVbPlfk2XnbHyS2J5LzFVaGugaxk4XbNOmneywOlV3zbCpFk2FOxK07CUa8J9RScR1nxh1fhjv7PzK0bvid7yhyQeZW-morlBxT8IzQXvk2DCZh8uUisdJLrqXKCRbaBttnKzU6MljrsiRANxqAiUvMYIi4BDP1fwi6fMUFRzxH2yVJevhf8Ybu5VxoGkZFwk3EZdef9TMqZlkuYzjqJDS9zuwQT11w1RUNT1KdiuOz9Iw0bt5wY2uyKBI9_kn5U2bfQU-Vi0fkg6ODcHarIzISYriB2tCOc-5ZWztpYRG43hXqU7ovhWtvSPVPiVPalWQ3rzVy_1c0UU_jkFdJp2O-e4Qv0cLYJ9Z7Ylb8KR_u82ZAs2IFZm43t_5wTFHhum4vpY4RbzB1o5Jcb7OpPqDskQSSOibdMBDwiHhjgZsqKip_tDL9S-l3nQWACbdma7yw6Xau6ZAV2Qt-ZfajBeuShdD7aafwBlLZ-CWMfCO9a50iMhF6uHsQAiYa9WqeXukXVHB9qFMgGysbSxs0sT6OiENtc9lg4PNoyrEA5-F6neHfU2mTKixi4AORbRQZfkrbMtZ5jvIjEm-zJZj49xfvUhN4ACtKC0E_tavkFhyOQhC7ijLWJNbOmvLTJLC9awDYIy-LKX3C16av7sAABaWSB2hG6aUu_4rLyNXVO_FuPvVlBRZi5BZtpbYdBnsHBzmLmxdkUCRWpcwDx23fnz7JzkoO1U_u1YLqTVx3ZxQTqEoDyg4MkIUlY9rzPvJjMhF80zfvEEVA6BRUqiGNmep6QEKY_3jTyWeuMZCmM8yLy_4r_LAwJOVjjQEAzS1TNy4GCaTB4lG5HjHnvZ-Hpq5CoyGF701FkKDrO3A9tq4PGGdxTdysAMXqHpFxbwxslTQpTVGsxaOmDe7IkzuoHD69gIIQ6pOGnFd0QfxHVpqDnegej5012sI9Hzf0yRUEGAq8T18SG3uNtNmeK49kOroqaWbuf1TEuVQ7KJCjMIKqgh8xroV_FKD--jM9W-Kx-2W1O79ah_x-xPm-QRRf5R8swpAb_75x7h9ciF6uM9rPKt7X-_FwUkD-FhwjDAysU4NaLm-4hLgTPJRUN-r6_q1LFmtG0ENk_ySZh142nIiN1mKBf-g_oZFmCjZm8-2JS6s__yb4AOhAZ6ydphZP1ZuckgKXRzP7EE9ub9BxRB_iHMfwXipaevkDR7xhAY3nzkuQKkGXnpvi56EOBZqz4apYekmhxVkhHxwsu1VJns4nY6kBoL-aPVQTAmD6cfgEVfaJRwNq_h5FSgfWkD9jghtcXnUwUed5cea0CmeAfSrJraeKKSnAiaFgcglM99eEPlTd4DnwVaVMP-M9jdMl1j0aKBYCC2QWwlzexUJEM1cBa_89WmwOaTQJQf7lgpVwIGRatOUTefIzB4R22DiXY893tpbhSYHzwYAjnXGHTIk9Y77sI3hncrW8-uPDqEac3gc_lsqALhskiva09NsxPOnxDYEtpdnSaEMdQPxzIjWByaEzEcldg3K6hNAmte9Ql1kbp-STm8s2qfT0LXXoqYe9a73jdqPjBQuBjP8_AoWRKIMb9ULZb-dBJOQHDtMgoDbuOSgvP2TpDfPkQLdF00J4ptB6WlFdYl0IlRsOrb24AmPNyVVT4vxeqkZHqVY55C7pfKUP5tQ_mTLPH0OyxQENyhRFHbTJd47m2CRdwfw92SNntUcO_T2xEXRnWt6QWo8IlM-iEYRfqSb218ZWX-x-dFlekT9bS3TA139uuPKkiwwT-Rj1-qYyRvDuUuQra1jq12KyIwnURAFBgQQmbpo_W5_GF_hutZ7WkIP1ITB4wr--HYyVWEXIJEaOI6kQeYiLnGwx2WrZOoqb93DWbEvpIjkQcYvySm0k2rL0pQU0No5eDrVomalJ6tHptTQIP-VmUjnPhbHwu4YY2xVDxbc5TVN_s6U45LKL41X25mizhZtmBEqmYN5x3UfVu-3AQV7OLCYY5nvmj0t-U03ph09Y-sAyi--Es7-ZK_fMa4YBbmymg9i91_4QrSZ9p7ujutBp-Diaispg2MMwDmHnhB3DHYBhM3fTNjTfOyEGkkB4zTCCYekiGPFvPQ89hRw1P-Z1NnLOZz7njYujXR9RpxaV4YcLEwpPIv4zkTGGkfht1GOlEDaHSAatowRgKtS2czIq1jCt3Tdd3ldCurPVXu7iUycdCU0GWsaugQuYtpIYl1-mt---E6aHTQhS1G0m1joQM6RkcM8OuK9bkNsJVY6mS4DqTMrrFdHTGmPs-Fh711ElCUrwIo4rUECqwPHB2PR1ntujCRTHbynokHaV_ftoP4L3UqB1ZZY0lmCuoL_YjiVekQT7X1G4j-vjY6tPnO8sB3WFvounOEbJ29TVjyZKiMe56sz0ep8OM025oTWaxI2sSJYfVe7YmvjcCUD4Hnn1Loe1GAFb9wmlefN3KcTVi_Ebn6XziqKJ05W-be26dyMRS2M8LcqEQxk9tix49VLkiTkXITr-SZhTHABpNYHzFEsSELik7iyncVTSCx4z5nXRH6omWw3SZKP9H5gpUb-EQ-NdtpPYh5st9Yg9YKoyNqyN67CD2jCAbSv1QJSgcKsxQShATarwst_kS20KLSh9ozQTQD0ChnqiYIJRpPyyBabABr3Lt6KY_18KAqT0gPwW13JnHEBbXJesHElsfrwjHlj2b9j5o1FhOu4W5kXUT0j-R3B6nqHSKX8hJwf7RwTwrgW5yRFecLBorq0N11onsa8QKsZByTCE-alD8b69Rb97WZTfOuPSazZg9B4ytPNsHgPUHalz2xQ3o9vKZeCGN9WOgf64CzLV9J_o4mh_xxycUXtshozTYygfj4DaR4taU65mn1MplrFk-o0TCx_bbFgKXHTAAMhVBoVfEBRcSoQEyv8SpW2ryspvdDcc0GxoT1lGWrMVPUUBhWzYTZhLFsXfynSKv9ZvV8HCugKrDgIdd2fGUyMAalXCtRZ8ui8JwriPo7Fyl2Y28Nl_anq3ame_ptmXbs_Tmm1ELJn0tx_q8LPFEM-8WGI4x79egPQHGnLzAxaRsgXEcC7krPlh5jH-Teb_vZSSt4GCao098EYA7lZQX_C5shkbh3Q3V22vOLPqqvCc0SE_o0H1MrzVMoznq1I365DWHpqJbW_UJm-H-hx5YXdJ3FHRnf2LmdZzzsmHWyeIvjS9Xaeu8uZFEqbZIBXUGorPxEsvtcabH-Vq37vNFKdmHTJVDdvVm9sfpJ_YXVhqpAgjMsA8JJtI-b6n3bh4XKxi8H39MdO-gaptFjtoUbM9YmnN__LrrFyqwa2IehfYao9MeekUsVNqlVBcuneWvW0h3e7LNb_ibiKy_sbVDTVbbll7SyYIzYLGRrGxrp6m5XyozwKL-wUhQn2BOlbyTXIKkGAa5TYRh-YWIkegRhZe1RXBqgbKvth6kJQZEs1UJESl8vighYJv0_yU9OdC4wHI5CiXRwgTtq_wSUYmQNq1I2yvldK-8TtRSPg1_bCa53XmNR9cWl9mGXFzYzk5oTQvwd2997OvMbyqp_-Ma_Y76KhPrJrRnaNYXV8ldJhm57QUWBDumJ6Peyc68TuMhf19qC0V7SmpN_9hJrki1qPcSrOZHxfH7jubX5uWtmAbF7LSOS3eakRG3K9dMZ3odoDihdI65XrlKYxYxylz-J9FZqk3Zhjb3YESie17LQDsiqCnOwzZfw8lkTOg74w"},"protocol":"org-iso-mdoc","timestamp":"2025-08-07T20:19:08.803Z"};
const iosParams = {"nonce":"4ab62598e2a5250a4ff6abafa0f56857","origin":"https://192.168.1.34:8000","jwk":{"crv":"P-256","d":"zJ7QWcKLfP2Mjx6MJ0Ri68gFhQ2aiYQjips7tC3p1V0","ext":true,"key_ops":["deriveBits","deriveKey"],"kty":"EC","x":"oD3JhSWMIBz6dNuZL4o8GY75LDLhQwEVTgBu0HjQZLE","y":"XYdPtoUldmqbMhN7_DXqNvAO4VS3mJFvLRnTqGvTccI"}};

test('verify generateNonce', () => {
    assert.doesNotThrow(async () => {
        const nonce = generateNonce();
        assert.equal(nonce.length, 32);
    });
});

test('verify generateJWK', async () => {
    assert.doesNotThrow(async () => {
        const jwk = await generateJWK();
        assert.equal(jwk.crv, 'P-256');
    });
});

test('processCredentials for Android', async () => {
    assert.doesNotThrow(async () => {
        const response = await processCredentials(androidCredentials, androidParams);
        assert.equal(response.claims.given_name, 'Erika');
        assert.equal(response.claims.family_name, 'Mustermann');
        assert.equal(response.claims.age_over_21, true);
    });
});

test('processCredentials for iOS', async () => {
    assert.doesNotThrow(async () => {
        const response = await processCredentials(iosCredentials, iosParams);
        assert.equal(response.claims.given_name, 'Kelly');
        assert.equal(response.claims.family_name, 'Garcia');
        assert.equal(response.claims.age_over_21, true);
    });
});